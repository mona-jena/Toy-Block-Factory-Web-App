---
steps:
  - label: 'test panic :cherry_blossom::whale:'
    command: 'docker build -f ./Dockerfile.test .' #why don't we run the tests?
    agents:
      queue: grace-lab
  - wait 
  - label: 'make dockerimage with tbf'
    command:
      - 'docker build -t 138666658526.dkr.ecr.ap-southeast-2.amazonaws.com/mona-app .' #is it finding app in current dir of VM?
      - 'docker push 138666658526.dkr.ecr.ap-southeast-2.amazonaws.com/mona-app'
    plugins:
      - ecr#v2.3.0:
          login: true
          account_ids: "138666658526"
          region: "ap-southeast-2"
    agents:
      queue: grace-lab 
  - wait
  - label: 'make dockerimage for web app'
    command: 
      - 'docker build -f ./Dockerfile.web . -t webapp'
      - 'docker run -d -p 3000:80 webapp' ##what's source port? #why do you need to run on detached mode?
    agents:
      queue: grace-lab
